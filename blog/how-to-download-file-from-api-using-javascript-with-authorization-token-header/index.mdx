---
title: 'How to download file from API using javascript with authorization token header'
date: '2021-12-07'
thumbnail: ./thumbnail.png
published: true
---

![Thumbnail](./thumbnail.png)

<br />

Generally, to download a file from API, we open the API URL in the browser, and the rest of the work browser does for us.

But sometimes APIs are behind authorization. So we need to add an authentication token in the request header otherwise API throws a 401 Unauthorized response. Let see how we can handle this situation in JavaScript.

```js
function download(url, filename = null) {
	// Token for authorization
	const token = 'Your Authorization Token';

	let xmlHttpRequest = new XMLHttpRequest();

	xmlHttpRequest.onreadystatechange = function () {
		if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200) {
			let a = document.createElement('a');
			a.href = window.URL.createObjectURL(xmlHttpRequest.response);

			// Get filename from Content-Disposition response header
			if (!filename) {
				const disposition = xmlHttpRequest.getResponseHeader(
					'Content-Disposition'
				);
				if (disposition && disposition.indexOf('attachment') !== -1) {
					const filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
					const matches = filenameRegex.exec(disposition);
					if (matches != null && matches[1]) {
						filename = matches[1].replace(/['"]/g, '');
					}
				}
			}

			a.download = filename;
			a.style.display = 'none';
			document.body.appendChild(a);
			a.click();
		}
	};

	// Set the request header (GET, POST, PUT, etc.)
	xmlHttpRequest.open('POST', url);

	// Set the Authorization header
	xmlHttpRequest.setRequestHeader('Authorization', `Bearer ${token}`);

	xmlHttpRequest.responseType = 'blob';

	// Set request body
	xmlHttpRequest.send(
		JSON.stringify({
			id: 9,
		})
	);
}
```
